<!DOCTYPE html>
<html>
<head>
    <title>MapView Canvas Rendering Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .proof { border: 2px solid #333; padding: 20px; margin: 20px 0; }
        canvas { border: 2px solid #999; image-rendering: pixelated; }
        .success { color: green; font-weight: bold; }
        .info { color: #666; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Proof: Canvas Rendering with FreeCiv Tiles</h1>
    
    <div class="proof">
        <h2>Test 1: Loading FreeCiv Tileset</h2>
        <div id="tileset-status">Loading...</div>
        <canvas id="tileset-test" width="300" height="30"></canvas>
    </div>
    
    <div class="proof">
        <h2>Test 2: Rendering Sample Map (with FreeCiv sprites)</h2>
        <div id="map-status">Waiting for tileset...</div>
        <canvas id="map-test" width="640" height="480"></canvas>
    </div>
    
    <div class="proof">
        <h2>Test 3: Fallback Rendering (colored squares)</h2>
        <div class="info">This shows what happens if tileset fails to load</div>
        <canvas id="fallback-test" width="640" height="480"></canvas>
    </div>
    
    <script>
        // Test 1: Load and display a row of terrain sprites
        const tilesetCanvas = document.getElementById('tileset-test');
        const tilesetCtx = tilesetCanvas.getContext('2d');
        const tilesetStatus = document.getElementById('tileset-status');
        
        const tilesetImg = new Image();
        tilesetImg.onload = function() {
            tilesetStatus.innerHTML = '<span class="success">✓ Tileset loaded successfully!</span>';
            tilesetStatus.innerHTML += '<div class="info">Image size: ' + this.width + 'x' + this.height + ' pixels</div>';
            
            tilesetCtx.imageSmoothingEnabled = false;
            
            // Draw 10 different terrain sprites in a row
            const sprites = [
                {x: 60, y: 0, name: 'Grassland'},     // row 0, col 2
                {x: 450, y: 120, name: 'Plains'},     // row 4, col 15
                {x: 450, y: 30, name: 'Desert'},      // row 1, col 15
                {x: 450, y: 300, name: 'Ocean'},      // row 10, col 15
                {x: 240, y: 0, name: 'Forest'},       // row 0, col 8
                {x: 120, y: 0, name: 'Hills'},        // row 0, col 4
                {x: 360, y: 0, name: 'Mountains'},    // row 0, col 12
                {x: 450, y: 90, name: 'Tundra'},      // row 3, col 15
                {x: 450, y: 180, name: 'Arctic'},     // row 6, col 15
                {x: 450, y: 150, name: 'Swamp'}       // row 5, col 15
            ];
            
            sprites.forEach((sprite, i) => {
                tilesetCtx.drawImage(
                    tilesetImg,
                    sprite.x, sprite.y, 30, 30,  // Source
                    i * 30, 0, 30, 30  // Destination
                );
            });
            
            // Now run Test 2
            renderMapTest();
        };
        
        tilesetImg.onerror = function() {
            tilesetStatus.innerHTML = '<span style="color:red">✗ Failed to load tileset</span>';
            tilesetStatus.innerHTML += '<div class="info">This is expected if server is not running or assets missing</div>';
        };
        
        tilesetImg.src = '/assets/freeciv/trident/tiles.png';
        
        // Test 2: Render a sample map with FreeCiv sprites
        function renderMapTest() {
            const mapCanvas = document.getElementById('map-test');
            const mapCtx = mapCanvas.getContext('2d');
            const mapStatus = document.getElementById('map-status');
            
            mapStatus.innerHTML = '<span class="success">✓ Rendering map with FreeCiv sprites...</span>';
            
            mapCtx.imageSmoothingEnabled = false;
            mapCtx.fillStyle = '#000';
            mapCtx.fillRect(0, 0, mapCanvas.width, mapCanvas.height);
            
            // Define terrain pattern (8x6 tiles at 32px each = 256x192, centered)
            const pattern = [
                ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'grassland', 'grassland', 'grassland', 'forest', 'forest', 'hills', 'hills', 'grassland', 'plains', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'grassland', 'plains', 'plains', 'forest', 'forest', 'hills', 'mountains', 'mountains', 'hills', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'grassland', 'grassland', 'plains', 'desert', 'desert', 'grassland', 'grassland', 'hills', 'mountains', 'mountains', 'hills', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'grassland', 'desert', 'desert', 'desert', 'grassland', 'grassland', 'grassland', 'grassland', 'hills', 'hills', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'grassland', 'grassland', 'grassland', 'grassland', 'grassland', 'tundra', 'tundra', 'grassland', 'grassland', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'grassland', 'grassland', 'tundra', 'tundra', 'tundra', 'arctic', 'tundra', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'ocean', 'grassland', 'grassland', 'tundra', 'arctic', 'arctic', 'tundra', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'grassland', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
                ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean']
            ];
            
            const sprites = {
                'grassland': {x: 60, y: 0},
                'plains': {x: 450, y: 120},
                'desert': {x: 450, y: 30},
                'ocean': {x: 450, y: 300},
                'forest': {x: 240, y: 0},
                'hills': {x: 120, y: 0},
                'mountains': {x: 360, y: 0},
                'tundra': {x: 450, y: 90},
                'arctic': {x: 450, y: 180},
                'swamp': {x: 450, y: 150}
            };
            
            const tileSize = 32;
            for (let row = 0; row < pattern.length; row++) {
                for (let col = 0; col < pattern[row].length; col++) {
                    const terrainType = pattern[row][col];
                    const sprite = sprites[terrainType];
                    if (sprite) {
                        mapCtx.drawImage(
                            tilesetImg,
                            sprite.x, sprite.y, 30, 30,  // Source (30x30 from tileset)
                            col * tileSize, row * tileSize, tileSize, tileSize  // Dest (32x32 on canvas)
                        );
                    }
                }
            }
            
            mapStatus.innerHTML += '<div class="success">✓ Map rendered with ' + (pattern.length * pattern[0].length) + ' tiles!</div>';
        }
        
        // Test 3: Fallback rendering with colored squares
        const fallbackCanvas = document.getElementById('fallback-test');
        const fallbackCtx = fallbackCanvas.getContext('2d');
        
        fallbackCtx.fillStyle = '#000';
        fallbackCtx.fillRect(0, 0, fallbackCanvas.width, fallbackCanvas.height);
        
        const colors = {
            'ocean': '#1e40af',
            'grassland': '#22c55e',
            'plains': '#84cc16',
            'desert': '#eab308',
            'forest': '#166534',
            'hills': '#a8a29e',
            'mountains': '#78716c',
            'tundra': '#e5e7eb',
            'arctic': '#f3f4f6',
            'swamp': '#a3e635'
        };
        
        const pattern2 = [
            ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'grassland', 'grassland', 'grassland', 'forest', 'forest', 'hills', 'hills', 'grassland', 'plains', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'grassland', 'plains', 'plains', 'forest', 'forest', 'hills', 'mountains', 'mountains', 'hills', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'grassland', 'grassland', 'plains', 'desert', 'desert', 'grassland', 'grassland', 'hills', 'mountains', 'mountains', 'hills', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'grassland', 'desert', 'desert', 'desert', 'grassland', 'grassland', 'grassland', 'grassland', 'hills', 'hills', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'grassland', 'grassland', 'grassland', 'grassland', 'grassland', 'tundra', 'tundra', 'grassland', 'grassland', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'grassland', 'grassland', 'tundra', 'tundra', 'tundra', 'arctic', 'tundra', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'ocean', 'grassland', 'grassland', 'tundra', 'arctic', 'arctic', 'tundra', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'grassland', 'grassland', 'grassland', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean'],
            ['ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean', 'ocean']
        ];
        
        const tileSize2 = 32;
        for (let row = 0; row < pattern2.length; row++) {
            for (let col = 0; col < pattern2[row].length; col++) {
                const terrainType = pattern2[row][col];
                const color = colors[terrainType];
                if (color) {
                    fallbackCtx.fillStyle = color;
                    fallbackCtx.fillRect(col * tileSize2, row * tileSize2, tileSize2, tileSize2);
                }
            }
        }
    </script>
</body>
</html>
