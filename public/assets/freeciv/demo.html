<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freeciv Assets Demo - SimCiv</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .demo-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        canvas {
            border: 2px solid #333;
            display: block;
            margin: 10px 0;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        .info {
            background: #e8f4f8;
            padding: 10px;
            border-left: 4px solid #2196F3;
            margin: 10px 0;
        }
        .sprite-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .sprite-item {
            text-align: center;
        }
        .sprite-item canvas {
            border: 1px solid #ccc;
        }
        .sprite-item label {
            display: block;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>Freeciv Assets Demonstration</h1>
    
    <div class="info">
        <strong>Note:</strong> This is a demonstration of the Freeciv Trident tileset assets integrated into SimCiv.
        All assets are from the Freeciv project (GPL-2.0) and are used under compatible GPL-3.0 license.
    </div>

    <div class="demo-section">
        <h2>Sample Map Tiles (30x30 pixels)</h2>
        <div id="terrainSprites" class="sprite-grid"></div>
    </div>

    <div class="demo-section">
        <h2>Simple Map Demo</h2>
        <p>A small procedurally generated map using Freeciv terrain tiles:</p>
        <canvas id="mapCanvas" width="600" height="480"></canvas>
    </div>

    <div class="demo-section">
        <h2>Unit Sprites</h2>
        <div id="unitSprites" class="sprite-grid"></div>
    </div>

    <div class="demo-section">
        <h2>City Sprites</h2>
        <div id="citySprites" class="sprite-grid"></div>
    </div>

    <script>
        // Sample sprite definitions (from tiles.spec)
        // Format: row and column in tiles.spec, where each tile is 30x30
        const terrainSprites = {
            grassland: { x: 60, y: 0, w: 30, h: 30, name: 'Grassland' },      // row 0, col 2
            hills: { x: 120, y: 0, w: 30, h: 30, name: 'Hills' },             // row 0, col 4
            forest: { x: 240, y: 0, w: 30, h: 30, name: 'Forest' },           // row 0, col 8
            mountains: { x: 360, y: 0, w: 30, h: 30, name: 'Mountains' },     // row 0, col 12
            desert: { x: 0, y: 30, w: 30, h: 30, name: 'Desert' },            // row 1, col 0
            plains: { x: 0, y: 120, w: 30, h: 30, name: 'Plains' },           // row 4, col 0
            jungle: { x: 0, y: 90, w: 30, h: 30, name: 'Jungle' },            // row 3, col 0
            tundra: { x: 0, y: 180, w: 30, h: 30, name: 'Tundra' },           // row 6, col 0
            arctic: { x: 0, y: 60, w: 30, h: 30, name: 'Arctic' },            // row 2, col 0 (layer 1 arctic)
            swamp: { x: 0, y: 150, w: 30, h: 30, name: 'Swamp' },             // row 5, col 0
            ocean: { 
                base: { x: 90, y: 0, w: 30, h: 30 },                          // row 0, col 3 (inaccessible1 - base)
                overlay: { x: 450, y: 300, w: 30, h: 30 },                    // row 10, col 15 (floor_n0e0s0w0 - overlay)
                name: 'Ocean'
            },
        };

        // Load terrain tileset
        const terrainImg = new Image();
        terrainImg.src = '/assets/freeciv/trident/tiles.png';

        // Load unit tileset
        const unitsImg = new Image();
        unitsImg.src = '/assets/freeciv/trident/units.png';

        // Load city tileset
        const citiesImg = new Image();
        citiesImg.src = '/assets/freeciv/trident/cities.png';

        // Counter for loaded images
        let imagesLoaded = 0;
        const totalImages = 3;

        function onImageLoad() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                initDemo();
            }
        }

        terrainImg.onload = onImageLoad;
        unitsImg.onload = onImageLoad;
        citiesImg.onload = onImageLoad;

        function initDemo() {
            displayTerrainSprites();
            generateSampleMap();
            displayUnitSprites();
            displayCitySprites();
        }

        function displayTerrainSprites() {
            const container = document.getElementById('terrainSprites');
            
            for (const [key, sprite] of Object.entries(terrainSprites)) {
                const item = document.createElement('div');
                item.className = 'sprite-item';
                
                const canvas = document.createElement('canvas');
                canvas.width = 60;
                canvas.height = 60;
                const ctx = canvas.getContext('2d');
                
                // Draw sprite at 2x scale for visibility
                ctx.imageSmoothingEnabled = false;
                
                // Special handling for ocean (layered rendering)
                if (key === 'ocean') {
                    // Draw base layer (inaccessible)
                    ctx.drawImage(terrainImg, 
                        sprite.base.x, sprite.base.y, sprite.base.w, sprite.base.h,
                        0, 0, 60, 60
                    );
                    // Draw overlay layer (floor)
                    ctx.drawImage(terrainImg, 
                        sprite.overlay.x, sprite.overlay.y, sprite.overlay.w, sprite.overlay.h,
                        0, 0, 60, 60
                    );
                } else {
                    ctx.drawImage(terrainImg, 
                        sprite.x, sprite.y, sprite.w, sprite.h,
                        0, 0, 60, 60
                    );
                }
                
                const label = document.createElement('label');
                label.textContent = sprite.name;
                
                item.appendChild(canvas);
                item.appendChild(label);
                container.appendChild(item);
            }
        }

        function generateSampleMap() {
            const canvas = document.getElementById('mapCanvas');
            const ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = false;
            
            const mapWidth = 20;
            const mapHeight = 16;
            const tileSize = 30;
            
            // Simple procedural map
            const terrainTypes = ['ocean', 'ocean', 'grassland', 'grassland', 'plains', 
                                 'forest', 'hills', 'mountains', 'desert'];
            
            for (let y = 0; y < mapHeight; y++) {
                for (let x = 0; x < mapWidth; x++) {
                    // Edge tiles are ocean
                    let terrainType;
                    if (x === 0 || x === mapWidth - 1 || y === 0 || y === mapHeight - 1) {
                        terrainType = 'ocean';
                    } else {
                        // Simple noise-like pattern
                        const seed = (x * 7 + y * 13) % terrainTypes.length;
                        terrainType = terrainTypes[seed];
                    }
                    
                    const sprite = terrainSprites[terrainType];
                    if (sprite) {
                        // Special handling for ocean (layered rendering)
                        if (terrainType === 'ocean') {
                            // Draw base layer (inaccessible)
                            ctx.drawImage(terrainImg,
                                sprite.base.x, sprite.base.y, sprite.base.w, sprite.base.h,
                                x * tileSize, y * tileSize, tileSize, tileSize
                            );
                            // Draw overlay layer (floor)
                            ctx.drawImage(terrainImg,
                                sprite.overlay.x, sprite.overlay.y, sprite.overlay.w, sprite.overlay.h,
                                x * tileSize, y * tileSize, tileSize, tileSize
                            );
                        } else {
                            ctx.drawImage(terrainImg,
                                sprite.x, sprite.y, sprite.w, sprite.h,
                                x * tileSize, y * tileSize, tileSize, tileSize
                            );
                        }
                    }
                }
            }
        }

        function displayUnitSprites() {
            const container = document.getElementById('unitSprites');
            
            // Unit positions from units.spec - corrected coordinates
            const unitSprites = [
                { x: 120, y: 30, w: 30, h: 30, name: 'Settlers' },   // row 1, col 4
                { x: 540, y: 0, w: 30, h: 30, name: 'Warriors' },    // row 0, col 18
                { x: 30, y: 30, w: 30, h: 30, name: 'Phalanx' },     // row 1, col 1
                { x: 240, y: 30, w: 30, h: 30, name: 'Archers' },    // row 1, col 8
                { x: 480, y: 0, w: 30, h: 30, name: 'Legion' },      // row 0, col 16
                { x: 510, y: 30, w: 30, h: 30, name: 'Pikemen' },    // row 1, col 17
            ];
            
            unitSprites.forEach(sprite => {
                const item = document.createElement('div');
                item.className = 'sprite-item';
                
                const canvas = document.createElement('canvas');
                canvas.width = 60;
                canvas.height = 60;
                const ctx = canvas.getContext('2d');
                ctx.imageSmoothingEnabled = false;
                
                ctx.drawImage(unitsImg,
                    sprite.x, sprite.y, sprite.w, sprite.h,
                    0, 0, 60, 60
                );
                
                const label = document.createElement('label');
                label.textContent = sprite.name;
                
                item.appendChild(canvas);
                item.appendChild(label);
                container.appendChild(item);
            });
        }

        function displayCitySprites() {
            const container = document.getElementById('citySprites');
            
            // City sprites from cities.spec - european cities row 1, cols 0-3
            const citySprites = [
                { x: 0, y: 30, w: 30, h: 30, name: 'City Size 1' },   // row 1, col 0
                { x: 30, y: 30, w: 30, h: 30, name: 'City Size 2' },  // row 1, col 1
                { x: 60, y: 30, w: 30, h: 30, name: 'City Size 3' },  // row 1, col 2
                { x: 90, y: 30, w: 30, h: 30, name: 'City Size 4' },  // row 1, col 3 (wall)
            ];
            
            citySprites.forEach(sprite => {
                const item = document.createElement('div');
                item.className = 'sprite-item';
                
                const canvas = document.createElement('canvas');
                canvas.width = 60;
                canvas.height = 60;
                const ctx = canvas.getContext('2d');
                ctx.imageSmoothingEnabled = false;
                
                ctx.drawImage(citiesImg,
                    sprite.x, sprite.y, sprite.w, sprite.h,
                    0, 0, 60, 60
                );
                
                const label = document.createElement('label');
                label.textContent = sprite.name;
                
                item.appendChild(canvas);
                item.appendChild(label);
                container.appendChild(item);
            });
        }
    </script>
</body>
</html>
