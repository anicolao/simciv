# SimCiv Minimal Simulator Expansion: Technology Prerequisites
## Adding Advanced Tool-Making to Test Prerequisite Chains

### Document Status
**Version:** 0.0023  
**Status:** Design Proposal  
**Last Updated:** 2025-11-05  
**Purpose:** Specification for adding a Level 1 technology with prerequisites to validate technology tree progression mechanics, building on the sequential technology system established in 0.0022

---

## Executive Summary

This document specifies the **next minimal increment** after 0.0022's Stone Knapping expansion. The goal is to add a third technology—**Advanced Tool-Making** (Level 1)—that requires Stone Knapping as a prerequisite, testing the technology tree's prerequisite chain mechanics for the first time.

**Key Decision: Advanced Tool-Making**

After reviewing the technology tree design (0.0004_TECH_TREE.md) and the existing minimal simulation capabilities, **Advanced Tool-Making** is selected as the third technology because it:

1. **Tests Prerequisites**: First Level 1 technology requiring Stone Knapping (Level 0)
2. **Different Effect Type**: Provides science production bonus (not food), testing diverse bonus types
3. **Enables Future Paths**: Required prerequisite for many Level 1+ technologies
4. **Clear Game Impact**: +25% science production bonus accelerates research
5. **Minimal Code Changes**: Requires ~60-80 lines of new production code
6. **Establishes Pattern**: Demonstrates technology tree progression Level 0 → Level 1

**Success Criteria:**

All three technologies (Fire Mastery, Stone Knapping, Advanced Tool-Making) must be researched in correct order:
1. Fire Mastery OR Stone Knapping first (both Level 0, no prerequisites)
2. Remaining Level 0 technology second
3. Advanced Tool-Making third (requires Stone Knapping prerequisite)
4. Simulation validates that prerequisite checking prevents Advanced Tool-Making research before Stone Knapping

---

## Rationale for Advanced Tool-Making

### Why Advanced Tool-Making (Not Another Tech)?

**Considered Alternatives:**

1. **Primitive Hunting** - Food bonus similar to existing techs, less interesting
2. **Basic Foraging** - Also food bonus, terrain-dependent complexity
3. **Primitive Shelter Construction** - Requires shelter capacity mechanics
4. **Fishing** - Terrain-dependent, adds complexity

**Why Advanced Tool-Making Wins:**

| Criterion | Advanced Tool-Making | Alternatives |
|-----------|---------------------|--------------|
| Prerequisites | Stone Knapping (tests prereq) | None or minimal |
| Effect Type | Science bonus (new type) | Mostly food bonuses |
| Code Complexity | Low (multiplier) | Low to medium |
| Future Dependencies | Required by many techs | Variable |
| Tests New Mechanic | YES (prerequisites) | No |
| Distinct Impact | Science acceleration | Similar to existing |

Advanced Tool-Making provides the **minimal expansion** while introducing the critical prerequisite chain mechanic that defines technology tree progression.

---

## Current State Analysis

### Existing Minimal Simulator (after 0.0022)

**Technologies:**
- Fire Mastery (100 science points, +15% food production, Level 0, no prerequisites)
- Stone Knapping (600 science points total, +20% food production, Level 0, no prerequisites)

**Mechanics:**
- Food production: Base rate × terrain × fire bonus × stone knapping bonus
- Science production: Work hours × science rate × health modifier
- Technologies unlock sequentially due to different costs (100, then 600)
- Population: 100 starting, with birth/death mechanics
- Science rate: 0.000011 (tuned for 5-10 year timeframes)
- Default allocation: 70% food / 30% science

**Test Coverage:**
- 50 seed-based deterministic tests
- Both Fire Mastery and Stone Knapping achieved in all viable runs
- Fire Mastery: ~5-10 years (1825-3650 days)
- Stone Knapping: ~12-17 years total (4380-6205 days)
- 100% viability rate with 70/30 allocation

### Gap: No Prerequisite Testing

The current simulator cannot test:
- ✗ Technology prerequisite validation (Stone Knapping → Advanced Tool-Making)
- ✗ Blocked research paths (can't research Level 1 without Level 0 prerequisite)
- ✗ Branching decisions (which Level 0 tech to research first affects Level 1 access)
- ✗ Non-food bonuses (all current bonuses are food production)

---

## Design: Advanced Tool-Making Addition

### Technology Specification (from 0.0004_TECH_TREE.md)

**Advanced Tool-Making**
- **Level**: 1 (requires prerequisite)
- **Prerequisites**: Stone Knapping (Level 0)
- **Research Cost**: 800 science points (total cumulative: 1500 points when including prerequisites)
- **Population Required**: 20 minimum (easily satisfied with 100+ starting population)
- **Resource Requirements**: None (simplified for minimal version)

**Effects:**
- +25% science production (applied to base science production calculation)
- Stacks multiplicatively with health modifier
- Combined science effect: Base × Health Modifier × 1.25 (with Advanced Tool-Making)
- Enables: Many Level 1 and Level 2 technologies in full tech tree (future expansion)

**Rationale for Research Cost:**
- Fire Mastery: 100 science points → 5-10 years
- Stone Knapping: 600 science points total → 12-17 years total (5+ years after Fire Mastery)
- Advanced Tool-Making: 1500 science points total → 20-27 years total (3-5 additional years after Stone Knapping)
- Sequential unlocking with prerequisites ensures proper progression testing

### Implementation Changes

#### 1. Update Technology State (types.go)

```go
// MinimalCivilizationState (add new field)
type MinimalCivilizationState struct {
    // ... existing fields ...
    
    // Technology (all Level 0 unlocked by default, Level 1 requires prerequisites)
    HasFireMastery     bool // Level 0: 100 science, 5-10 years
    HasStoneKnapping   bool // Level 0: 600 science, 12-17 years
    HasAdvancedTools   bool // Level 1: 1500 science, 20-27 years, requires Stone Knapping [NEW]
    
    // ... existing fields ...
}
```

#### 2. Add Science Production Bonus (mechanics.go)

**Critical Change: Science Production Enhancement**

```go
// produceScience calculates science production for the day
func produceScience(scienceHours float64, hasAdvancedTools bool, avgHealth float64) float64 {
    // Health modifier (from 0.0005_HUMAN_ATTRIBUTES.md)
    healthModifier := 1.0
    if avgHealth < 30 {
        healthModifier = 0.5
    }
    
    // Base science production
    science := scienceHours * ScienceBaseRate * healthModifier
    
    // Advanced Tool-Making bonus [NEW]
    if hasAdvancedTools {
        science *= 1.25 // +25% science production
    }
    
    return science
}
```

#### 3. Update Technology Unlock Check (mechanics.go)

```go
// Constants (add to existing)
const (
    // ... existing constants ...
    
    FireMasteryScienceRequired      = 100.0
    StoneKnappingScienceRequired    = 600.0
    AdvancedToolsScienceRequired    = 1500.0 // [NEW] - Total cumulative science
)

// checkTechnologyUnlocks checks if any technologies should be unlocked
func checkTechnologyUnlocks(state *MinimalCivilizationState) []string {
    unlocked := []string{}
    
    // Check Level 0 technologies (no prerequisites)
    if !state.HasFireMastery && state.SciencePoints >= FireMasteryScienceRequired {
        state.HasFireMastery = true
        unlocked = append(unlocked, "Fire Mastery")
    }
    
    if !state.HasStoneKnapping && state.SciencePoints >= StoneKnappingScienceRequired {
        state.HasStoneKnapping = true
        unlocked = append(unlocked, "Stone Knapping")
    }
    
    // Check Level 1 technologies (with prerequisites) [NEW]
    if !state.HasAdvancedTools && 
       state.HasStoneKnapping && // Prerequisite check [NEW]
       state.SciencePoints >= AdvancedToolsScienceRequired {
        state.HasAdvancedTools = true
        unlocked = append(unlocked, "Advanced Tool-Making")
    }
    
    return unlocked
}
```

#### 4. Update Starting Conditions (simulator.go)

No changes needed - all technologies start as `false` (not unlocked). Prerequisites are validated at unlock time.

#### 5. Update Simulation Loop (simulator.go)

```go
// RunSimulation (update science production call)
scienceProduction := produceScience(scienceHours, state.HasAdvancedTools, avgHealth)

// Update technology unlock check (no change needed - already returns array)
techsUnlocked := checkTechnologyUnlocks(state)
if len(techsUnlocked) > 0 {
    // Technologies unlocked!
}
```

#### 6. Update Viability Criteria (simulator.go)

The viability criteria changes to include three technologies:

**Previous (Two Technologies):**
- Simulation runs until both Fire Mastery AND Stone Knapping unlocked OR max days (7300 = 20 years)

**New (Three Technologies with Prerequisites):**
- Simulation runs until all three technologies unlocked OR max days (10950 = 30 years)
- Viability = Fire Mastery AND Stone Knapping AND Advanced Tool-Making all unlocked
- Expected timeline:
  - Fire Mastery: 5-10 years (1825-3650 days)
  - Stone Knapping: 12-17 years total (4380-6205 days)
  - Advanced Tool-Making: 20-27 years total (7300-9855 days)

```go
// Updated termination condition
if state.HasFireMastery && state.HasStoneKnapping && state.HasAdvancedTools {
    break // All three technologies unlocked - success!
}
```

---

## New Test Specification

### Test 1: Technology Prerequisite Validation

This test validates that prerequisite checking works correctly:

```go
// TestTechnologyPrerequisites tests that Advanced Tool-Making requires Stone Knapping
func TestTechnologyPrerequisites(t *testing.T) {
    state := &MinimalCivilizationState{
        HasFireMastery:   true,
        HasStoneKnapping: false,
        HasAdvancedTools: false,
        SciencePoints:    1500.0, // Enough for Advanced Tool-Making
    }
    
    // Should NOT unlock Advanced Tool-Making (missing Stone Knapping prerequisite)
    unlocked := checkTechnologyUnlocks(state)
    
    if state.HasAdvancedTools {
        t.Errorf("Advanced Tool-Making unlocked without Stone Knapping prerequisite")
    }
    
    // Now add Stone Knapping
    state.HasStoneKnapping = true
    unlocked = checkTechnologyUnlocks(state)
    
    // Should unlock Advanced Tool-Making now
    if !state.HasAdvancedTools {
        t.Errorf("Advanced Tool-Making should unlock when Stone Knapping prerequisite satisfied")
    }
    
    if len(unlocked) != 1 || unlocked[0] != "Advanced Tool-Making" {
        t.Errorf("Expected 'Advanced Tool-Making' in unlocked list, got %v", unlocked)
    }
}
```

### Test 2: Science Production Bonus

This test validates that Advanced Tool-Making increases science production:

```go
// TestScienceProductionBonus tests that Advanced Tool-Making provides +25% science
func TestScienceProductionBonus(t *testing.T) {
    baseScience := 100.0
    avgHealth := 50.0 // Above 30, so no health penalty
    
    tests := []struct {
        name             string
        hasAdvancedTools bool
        expectedMultiplier float64
    }{
        {"Without Advanced Tools", false, 1.0},
        {"With Advanced Tools", true, 1.25},
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            result := produceScience(baseScience, tt.hasAdvancedTools, avgHealth)
            
            // Base: baseScience * ScienceBaseRate * healthModifier (1.0)
            expectedBase := baseScience * ScienceBaseRate * 1.0
            expected := expectedBase * tt.expectedMultiplier
            
            epsilon := 0.0001
            if result < expected-epsilon || result > expected+epsilon {
                t.Errorf("Expected %f, got %f", expected, result)
            }
        })
    }
}
```

### Test 3: Three Technology Viability

This test validates that populations can research all three technologies:

```go
// TestViabilityWithThreeTechnologies tests that populations can research all three techs
func TestViabilityWithThreeTechnologies(t *testing.T) {
    conditions := DefaultStartingConditions()
    
    viableCount := 0
    allThreeTechsCount := 0
    
    for _, seed := range VIABILITY_TEST_SEEDS {
        config := SimulationConfig{
            Seed:               seed,
            StartingConditions: conditions,
            MaxDays:            10950, // 30 years (to allow for three sequential technologies)
        }
        
        result := RunSimulation(config)
        
        if result.IsViable {
            viableCount++
        }
        
        if result.HasFireMastery && result.HasStoneKnapping && result.HasAdvancedTools {
            allThreeTechsCount++
        }
    }
    
    // All three technologies should be researched in 100% of viable runs
    if allThreeTechsCount != len(VIABILITY_TEST_SEEDS) {
        t.Errorf("Expected all 50 seeds to unlock all three technologies, got %d/%d", 
            allThreeTechsCount, len(VIABILITY_TEST_SEEDS))
    }
    
    // Viability rate should remain 100% with three technologies
    if viableCount != len(VIABILITY_TEST_SEEDS) {
        t.Errorf("Expected 100%% viability with three technologies, got %d/%d viable",
            viableCount, len(VIABILITY_TEST_SEEDS))
    }
}
```

### Test 4: Technology Unlock Order

This test validates that technologies unlock in the correct order:

```go
// TestTechnologyUnlockOrder tests that technologies unlock in correct prerequisite order
func TestTechnologyUnlockOrder(t *testing.T) {
    conditions := DefaultStartingConditions()
    config := SimulationConfig{
        Seed:               VIABILITY_TEST_SEEDS[0], // Use first seed for deterministic test
        StartingConditions: conditions,
        MaxDays:            10950,
    }
    
    result := RunSimulation(config)
    
    // Verify all three technologies were unlocked
    if !result.HasFireMastery || !result.HasStoneKnapping || !result.HasAdvancedTools {
        t.Errorf("Not all technologies unlocked: Fire=%v, Stone=%v, Advanced=%v",
            result.HasFireMastery, result.HasStoneKnapping, result.HasAdvancedTools)
        return
    }
    
    // Check unlock days from simulation history
    // Fire Mastery or Stone Knapping should unlock first (both Level 0)
    // Advanced Tool-Making should unlock last (requires Stone Knapping)
    
    // This requires tracking unlock days in SimulationResult (enhancement)
    // For now, verify that final state has all technologies
    if !result.HasAdvancedTools || !result.HasStoneKnapping {
        t.Errorf("Advanced Tool-Making unlocked but prerequisite check failed")
    }
}
```

---

## Expected Simulation Behavior

### Timeline with Three Technologies

**Starting Conditions:**
- Population: 100
- Average health: 40
- Food stockpile: 100
- Science points: 0
- Food allocation: 70%

**Years 1-7: Pre-Fire Mastery Era**
- Food production: ~280 units/day (base rate)
- Food consumption: ~200 units/day (100 people)
- Net food: +80 units/day (surplus building)
- Science accumulation: ~0.036 points/day (at 30 work hours/day on science)
- Population: Stable to growing
- Total science: 0 → 100 points over ~5-10 years

**Year 7 (±2 years): Fire Mastery Unlocks**
- Fire Mastery unlocked at 100 science points
- Food production bonus: +15% (280 → 322 units/day)
- Net food: +122 units/day
- Science accumulation: continues at ~0.036 points/day
- Population: 100 → 105-110

**Years 8-15: Fire Mastery to Stone Knapping**
- Food production: ~322 units/day (with Fire Mastery)
- Population growing: 105-110 → 115-125
- Science accumulation: ~0.036 points/day
- Total science: 100 → 600 points over additional 5-7 years

**Year 15 (±2 years): Stone Knapping Unlocks**
- Stone Knapping unlocked at 600 total science points
- Combined food bonus: +38% (322 → 387 units/day)
- Net food: +187 units/day (massive surplus)
- Science accumulation: continues at ~0.036 points/day (no science bonus yet)
- Population: 115-125 → 130-145

**Years 16-25: Stone Knapping to Advanced Tool-Making**
- Food production: ~387 units/day (Fire + Stone bonuses)
- Population growing: 130-145 → 150-170
- Science accumulation: ~0.036 points/day (still no science bonus)
- Total science: 600 → 1500 points over additional 5-10 years
- **Note**: Science rate remains constant (no bonus yet) until Advanced Tool-Making unlocks

**Year 25 (±2 years): Advanced Tool-Making Unlocks**
- Advanced Tool-Making unlocked at 1500 total science points
- Science production bonus: +25% (0.036 → 0.045 points/day)
- Food bonuses remain: +38% (387 units/day)
- Population: 150-170 (well-fed, growing)
- Health: 60-70 (excellent nutrition)

**Years 26-30: Post-All-Technologies Era**
- Population grows rapidly: 170 → 190-220
- Science production accelerated: 0.045 points/day (with Advanced Tools)
- Food stockpile continues growing
- Simulation demonstrates stable viability with prerequisite-based progression

**Expected Final Metrics (Day 10950 = 30 years):**
- Population: 190-220 (substantial growth)
- Average health: 65-75 (very well-fed)
- Food stockpile: 30,000+ (enormous surplus)
- Science points: 1500+ (all technologies unlocked)
- Fire Mastery: Unlocked at ~5-10 years ✓
- Stone Knapping: Unlocked at ~12-17 years ✓
- Advanced Tool-Making: Unlocked at ~20-27 years ✓

---

## Backward Compatibility

### Existing Tests Must Still Pass

All existing tests remain valid and must pass with updated expectations:

1. ✓ `TestRandomGenerator_*` - Unchanged
2. ✓ `TestInitializePopulation` - Unchanged
3. ✓ `TestCalculateAvailableLabor` - Unchanged
4. ✓ `TestAllocateLabor` - Unchanged
5. ✓ `TestProduceFood` - Unchanged (food production independent of science bonus)
6. ✓ `TestProduceScience` - **Updated signature** (add hasAdvancedTools parameter)
7. ✓ `TestConsumeFood` - Unchanged
8. ✓ `TestUpdateHealth` - Unchanged
9. ✓ `TestCheckMortality` - Unchanged
10. ✓ `TestCheckReproduction` - Unchanged
11. ✓ `TestSimulation_BasicRun` - **Updated max days** (1000 → 2000+ for meaningful progress)
12. ✓ `TestViabilityWithMultipleSeeds` - **Updated criteria** (three techs, 30 years)
13. ✓ `TestViabilityStatistics` - **Updated expectations** (longer timeframes)
14. ✓ `TestTechnologyBonusStacking` - **Updated to test science bonus** separately from food
15. ✓ `TestViabilityWithTwoTechnologies` - Remains as-is (can be kept or deprecated)

**Migration Strategy:**

Existing tests that call `produceScience()` need updated signatures:
```go
// Old (from 0.0022)
produceScience(hours, avgHealth)

// New (0.0023)
produceScience(hours, false, avgHealth) // false = no Advanced Tool-Making yet
```

---

## Code Changes Summary

### Files to Modify

1. **types.go**
   - Add `HasAdvancedTools bool` field to `MinimalCivilizationState`
   - ~1 line added

2. **mechanics.go**
   - Add `AdvancedToolsScienceRequired` constant (1500.0)
   - Update `produceScience()` signature and logic (add hasAdvancedTools parameter)
   - Update `checkTechnologyUnlocks()` to check Advanced Tool-Making with prerequisite
   - ~15 lines modified, ~8 lines added

3. **simulator.go**
   - Update science production call in main loop (pass hasAdvancedTools)
   - Update viability termination condition (check three technologies)
   - Update default MaxDays (7300 → 10950 for 30-year simulations)
   - ~6 lines modified

4. **simulator_test.go**
   - Add `TestTechnologyPrerequisites` test
   - Add `TestScienceProductionBonus` test
   - Add `TestViabilityWithThreeTechnologies` test
   - Add `TestTechnologyUnlockOrder` test
   - Update `TestProduceScience` test cases for new signature
   - Update `TestViabilityWithMultipleSeeds` to check three technologies and 30-year timeframe
   - Update multiple tests for 30-year simulation duration
   - ~40 lines modified, ~100 lines added

**Total Code Changes:** ~170 lines (30 production code, 140 test code)

---

## Validation Criteria

### The implementation is successful if:

1. **All Existing Tests Pass**
   - No regressions in current functionality
   - Backward compatibility maintained
   - Two-technology tests still work

2. **New Tests Pass**
   - `TestTechnologyPrerequisites` validates prerequisite checking
   - `TestScienceProductionBonus` validates +25% science bonus
   - `TestViabilityWithThreeTechnologies` validates three-tech research
   - `TestTechnologyUnlockOrder` validates correct unlock sequence

3. **50-Seed Viability**
   - All 50 predefined seeds achieve all three technologies
   - 100% viability rate maintained
   - Technologies unlock in correct order (Level 0 before Level 1)

4. **Prerequisite Validation**
   - Advanced Tool-Making cannot be researched without Stone Knapping
   - Prerequisite checking works correctly
   - No technology unlocks out of order

5. **Code Quality**
   - Clean, readable implementation
   - Follows existing code patterns
   - Well-commented for future expansion

---

## Future Expansion Path

This prerequisite expansion establishes patterns for adding more complex technology chains:

### Phase 4: Branch Point Technologies (Future)
- Add multiple Level 1 technologies with same prerequisites
- Test player choice between different paths
- Example: Advanced Tool-Making OR Primitive Hunting (both require Stone Knapping)

### Phase 5: Cross-Level Prerequisites (Future)
- Add Level 2 technology requiring Level 1 technology
- Test multi-level prerequisite chains
- Example: Copper Working requires Advanced Tool-Making

### Phase 6: Multiple Prerequisites (Future)
- Add technology requiring 2+ prerequisites
- Test complex prerequisite validation
- Example: Pottery requires Fire Mastery AND Basic Foraging

### Phase 7: Technology Tree Visualization (Future)
- Display available vs. locked technologies
- Show prerequisite relationships visually
- Enable player technology choice interface

---

## Design Rationale

### Why This Is the "Next Smallest Increment"

**What Makes This Minimal:**

1. **Single Technology Added**: Only one new tech (Advanced Tool-Making)
2. **Tests One New Mechanic**: Prerequisites (most important tree mechanic)
3. **Simple Effect**: Science production multiplier (like food bonuses before)
4. **Single Prerequisite**: Only requires Stone Knapping (simplest case)
5. **No Branching Yet**: Linear progression (deferred to Phase 4)
6. **Minimal Code**: ~30 lines of production code
7. **Reuses Test Framework**: Existing test patterns extended

**What This Validates:**

1. ✓ Prerequisite checking works correctly
2. ✓ Technologies unlock in proper order
3. ✓ Level 0 → Level 1 progression functions
4. ✓ Science bonus type (not just food bonuses)
5. ✓ 30-year simulation viability
6. ✓ Three-technology research progression
7. ✓ Foundation for complex tech tree

**What This Defers (Future Work):**

- ✗ Branching paths (multiple Level 1 choices from same Level 0)
- ✗ Multiple prerequisites (tech requiring 2+ earlier techs)
- ✗ Level 2+ technologies (deferred to Phase 5)
- ✗ Technology choice UI (deferred to Phase 7)
- ✗ More complex effects (unit unlocks, building types)
- ✗ Terrain/resource prerequisites

---

## Implementation Notes

### Development Sequence

1. **Update Types** - Add HasAdvancedTools field (~5 minutes)
2. **Update Mechanics** - Add prerequisite checking to unlock logic (~20 minutes)
3. **Update Science Production** - Add hasAdvancedTools parameter and bonus (~15 minutes)
4. **Update Simulator** - Integrate new tech into main loop (~10 minutes)
5. **Update Tests** - Fix signature changes (~20 minutes)
6. **Add Prerequisite Test** - New prerequisite validation test (~20 minutes)
7. **Add Science Bonus Test** - New science production test (~15 minutes)
8. **Add Three-Tech Test** - New viability test (~20 minutes)
9. **Run Full Test Suite** - Validate all 50 seeds with 30-year runs (~15 minutes)
10. **Document Results** - Update test output documentation (~10 minutes)

**Total Estimated Development Time:** 150 minutes (2.5 hours)

### Testing Strategy

**Unit Tests (New):**
- `TestTechnologyPrerequisites` - Validates prerequisite checking logic
- `TestScienceProductionBonus` - Validates science calculation correctness

**Integration Tests (Updated):**
- `TestViabilityWithMultipleSeeds` - Three techs unlocked in all 50 seeds
- `TestViabilityWithThreeTechnologies` - New test for three-tech research

**Regression Tests (Existing):**
- All existing tests must pass with updated signatures
- Two-technology tests remain valid

---

## Success Metrics

### Quantitative Metrics

| Metric | Target | Rationale |
|--------|--------|-----------|
| Viability Rate | 100% (50/50 seeds) | All technologies achievable |
| Days to Fire Mastery | 1825-3650 days | 5-10 year realistic timeframe |
| Days to Stone Knapping | 4380-6205 days | 12-17 years total |
| Days to Advanced Tools | 7300-9855 days | 20-27 years total |
| Test Pass Rate | 100% (all tests) | No regressions |
| Prerequisite Validation | 100% correct | No out-of-order unlocks |
| Code Coverage | >90% | Well-tested implementation |

### Qualitative Metrics

1. **Code Clarity**: Prerequisite checking is clear and maintainable
2. **Test Clarity**: Tests document prerequisite behavior
3. **Maintainability**: Easy to add fourth technology with prerequisites
4. **Documentation**: Design rationale clearly explained

---

## Related Documents

- **0.0004_TECH_TREE.md**: Full technology tree specification (Advanced Tool-Making details)
- **0.0006_MINIMAL_SIMULATOR.md**: Original minimal simulator design (Fire Mastery only)
- **0.0022_STONE_KNAPPING_EXPANSION.md**: Previous expansion (Stone Knapping, two technologies)
- **0.0018_VICTORY_PROGRESSION_TREES.md**: Four tree system overview
- **PREHISTORY_TREES.md**: Prehistoric technology progression overview

---

## Conclusion

This design specifies the **next minimal increment** after the Stone Knapping expansion (0.0022). By adding Advanced Tool-Making as the first Level 1 technology with a Stone Knapping prerequisite, we:

1. **Test Prerequisite Chains**: Validate that technology tree progression works correctly
2. **Test New Bonus Type**: Science production bonus (not food), expanding game mechanics
3. **Validate Three Technologies**: Ensure simulator handles three sequential research goals
4. **Enable Future Growth**: Prerequisites are foundation for entire technology tree
5. **Minimize Code Changes**: ~30 lines of production code, ~140 lines of test code
6. **Maintain Quality**: All existing tests updated, new tests added
7. **Establish Pattern**: Level 0 → Level 1 progression pattern for future technologies

**Key Design Decisions:**

- Advanced Tool-Making chosen for prerequisite testing and science bonus
- Single prerequisite (Stone Knapping) for simplicity
- Science cost: 1500 total points for ~20-27 year unlock
- Science production bonus: +25% (accelerates research)
- Technologies unlock sequentially: Fire/Stone → remaining Level 0 → Advanced Tools
- Viability criteria: all three technologies within 30 years

**Expected Outcome:**

After this expansion, the minimal simulator will demonstrate:
- Prerequisite checking prevents out-of-order technology research
- Level 1 technologies unlock after Level 0 prerequisites satisfied
- Science bonuses accelerate future research (distinct from food bonuses)
- Three technologies unlock over realistic 25+ year timespan
- Foundation established for complex technology tree with branching paths
- Code ready for adding fourth technology with branching choices

This expansion represents a **focused, testable, incremental improvement** that validates the critical prerequisite mechanism while maintaining the minimal simulator's simplicity and reliability.

---

**Document Version:** 0.0023  
**Implementation Status:** Design Proposal (Not Yet Implemented)  
**Next Steps:** 
1. Review and approve this design
2. Implement code changes as specified
3. Run full test suite (all 50 seeds over 30-year simulations)
4. Verify prerequisite checking works correctly
5. Document results and update design if needed

---

## Revision History

**Version 0.0023 (2025-11-05)**:
- Initial design specification for prerequisite technology testing
- Adds Advanced Tool-Making (Level 1) requiring Stone Knapping (Level 0)
- First technology with prerequisites in minimal simulator
- Science production bonus (+25%) as new bonus type
- 30-year simulation timeframe for three technologies
- Establishes foundation for technology tree prerequisite chains
